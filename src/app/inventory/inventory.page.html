<ion-content>

  <ion-toolbar>
    <img src="../../assets/dungeon-logo.png" id="header-logo" (click)="goToMenu()" alt="Dungeon Logo" />
  </ion-toolbar>

  <p class="loading-text" *ngIf="isLoading">
    Cargando inventario...
  </p>

  <div class="page-container" *ngIf="!isLoading">
    <div class="inventory-header">
      <div class="header-left">
        <h1 class="inventory-title">Inventario de tus Personajes</h1>
        <p class="inventory-description">Administra los objetos de tus aventureros</p>
      </div>
      <div class="user-stats" *ngIf="infoUser">
        <div class="user-stat-item">
          <span>{{ infoUser.coins }} gold</span>
        </div>
        <div class="user-stat-item">
          <span>{{ infoUser.xp }} XP</span>
        </div>
      </div>
    </div>

    <div class="characters-container" *ngIf="characters.length > 0">
      <div *ngFor="let character of characters" class="character-card">

        <div class="character-header">
          <div class="character-title-group">
            <h2 class="character-name">{{ character.name }}</h2>
            <span class="character-race">{{ character.state.race }}</span>
          </div>
          <div class="character-xp">
            <span>{{ character.xp || 0 }} XP</span>
          </div>
        </div>

        <div class="character-info-row">
          <div class="character-stats">
            <div class="stat-item">
              <span class="stat-label">HP</span>
              <span class="stat-value">{{ character.hp }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">STR</span>
              <span class="stat-value">{{ character.strength }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">AGI</span>
              <span class="stat-value">{{ character.agility }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">LUCK</span>
              <span class="stat-value">{{ character.luck }}</span>
            </div>
          </div>
          <div class="character-status">
            <span class="status-badge" [ngClass]="{'alive': character.alive, 'dead': !character.alive}">
              {{ character.alive ? 'VIVO' : 'MUERTO' }}
            </span>
          </div>
        </div>

        <div class="items-divider">
          <span>Objetos</span>
        </div>

        <div class="items-grid" *ngIf="getItemsByCharacter(character.id).length > 0">
          <div *ngFor="let item of getItemsByCharacter(character.id)" class="item-card">
            <div class="item-header">
              <h4 class="item-name">{{ item.name }}</h4>
              <span class="rarity-badge" [ngClass]="item.rareza">{{ item.rareza }}</span>
            </div>

            <p class="item-description">{{ item.description }}</p>

            <div class="item-footer">
              <span class="item-price">{{ item.price }} gold</span>
            </div>

            <div class="item-actions" *ngIf="!item.on_market">
              <ion-button size="small" fill="outline" (click)="venderitem(item.id)" class="action-btn quick-sell-btn">
                <span>Venta Rápida</span>
              </ion-button>
              <ion-button size="small" fill="outline" (click)="transferItem(item)" class="action-btn transfer-btn">
                <span>Transferir</span>
              </ion-button>
              <ion-button size="small" (click)="publishMarket(item)" class="action-btn market-btn">
                <span>Vender en Market</span>
              </ion-button>
            </div>
            <div class="item-actions" *ngIf="item.on_market">
              <ion-button size="small" color="warning" (click)="removeFromMarket(item)" class="action-btn remove-btn">
                <span>Retirar del Market</span>
              </ion-button>
            </div>
          </div>
        </div>

        <div class="no-items" *ngIf="getItemsByCharacter(character.id).length === 0">
          <p>Este personaje no tiene objetos</p>
        </div>

      </div>
    </div>

    <div class="no-characters" *ngIf="characters.length === 0">
      <h2>No tienes personajes</h2>
      <p>Crea un personaje para empezar tu aventura</p>
    </div>
  </div>

  <ion-modal [isOpen]="showTransferModal" (didDismiss)="cancelTransfer()" class="character-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Selecciona un personaje</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <div class="modal-content">
          <p class="modal-description">
            ¿A qué personaje quieres transferir <strong class="item-name">{{ selectedItem?.name }}</strong>?
          </p>

          <ion-list *ngIf="availableCharacters.length > 0" class="character-list">
            <ion-item button *ngFor="let character of availableCharacters"
              (click)="selectCharacterForTransfer(character)" class="character-item" lines="full">
              <ion-label>
                <h2 class="character-name">{{ character.name }}</h2>
                <p class="character-info">{{ character.state.race }}</p>
              </ion-label>
            </ion-item>
          </ion-list>

          <p *ngIf="availableCharacters.length === 0" class="no-characters">
            No tienes otros personajes disponibles para transferir
          </p>

          <ion-button expand="block" color="medium" (click)="cancelTransfer()" class="cancel-button">
            Cancelar
          </ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>