<ion-content>

  <ion-toolbar>
    <img src="../../assets/dungeon-logo.png" id="header-logo" (click)="goToMenu()" alt="Dungeon Logo" />
  </ion-toolbar>


  <p class="loading-text" *ngIf="isLoading">
    Loading...
  </p>

  <div *ngIf="!isLoading">
    <div class="shop-info">
      <p class="shop-title">¡Descubre los objetos del día!</p>
      <p class="shop-sub">Cada día nuevos objetos</p>
      <p class="update-date">Actualizado: {{ lastUpdate }}</p>
    </div>

    <div class="user-gold" *ngIf="infoUser">
      <span class="gold-label">Gold:</span>
      <span class="gold-amount">{{ infoUser.coins }}</span>
      
    </div>

    <div class="items-list">
      <div class="item-card" *ngFor="let item of items">
        <h2>{{ item.name }}</h2>
        <p class="desc" [ngClass]="{'long': (item.description?.length || 0) > 55}">{{ item.description }}</p>
        <div class="price-row">
          <span class="price">{{ item.price }} gold</span>
          <ion-button size="small" (click)="buyItem(item)" [disabled]="!infoUser || infoUser.coins < item.price">
            Comprar
          </ion-button>
        </div>
      </div>
      <div class="item-card call-to-action" *ngIf="items.length === 0">
        <h2>¡Vuelve pronto!</h2>
        <p class="desc">La tienda se está reabasteciendo. Pronto habrá nuevos objetos para ti.</p>
      </div>
    </div>
  </div>

  <ion-modal [isOpen]="showCharacterModal" (didDismiss)="cancelPurchase()" class="character-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Selecciona un personaje</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <div class="modal-content">
          <p class="modal-description">
            ¿A qué personaje quieres asignar <strong class="item-name">{{ selectedItem?.name }}</strong>?
          </p>

          <ion-list *ngIf="characters.length > 0" class="character-list">
            <ion-item button *ngFor="let character of characters" (click)="selectCharacter(character)"
              class="character-item" lines="full">
              <ion-label>
                <h2 class="character-name">{{ character.name }}</h2>
                <p class="character-info">Nivel {{ character.level || 1 }} - {{ character.class || 'Aventurero' }}</p>
              </ion-label>
            </ion-item>
          </ion-list>

          <p *ngIf="characters.length === 0" class="no-characters">
            No tienes personajes disponibles
          </p>

          <ion-button expand="block" color="medium" (click)="cancelPurchase()" class="cancel-button">
            Cancelar
          </ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>